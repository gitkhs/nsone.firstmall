{ #layout_header }
<style>
div .connectCategory { width:97%; float:left; cursor:hand; }
{?  promotion.promotion_img  == 4 && promotion.promotion_image4 }
.promotioncodeshow {position:relative; height:40px; width:600px; margin:auto; background:url('/data/promotion/{promotion.promotion_image4}');width:870px; height:40px; line-height:40px; text-align:center; font-size:16px; font-family:dotum; font-weight:bold; color:#fff; letter-spacing:-1px;}
{:}
.promotioncodeshow {position:relative; height:40px; width:600px; margin:auto; background:url('/data/promotion/promotion_skin_01.gif');width:870px; height:40px; line-height:40px; text-align:center; font-size:16px; font-family:dotum; font-weight:bold; color:#fff; letter-spacing:-1px;}
{/}
</style>

<script type="text/javascript" src="/app/javascript/plugin/jquery.colorpicker.min.js"></script>
<script type="text/javascript" src="/app/javascript/plugin/custom-color-picker.js"></script>
<script type="text/javascript" src="/app/javascript/plugin/custom-font-decoration.js"></script>
<script type="text/javascript" src="/app/javascript/js/base64.js"></script>
<link rel="stylesheet" type="text/css" href="/app/javascript/plugin/jquploadify/uploadify.css" />
<script type="text/javascript" src="/app/javascript/plugin/jquploadify/jquery.uploadify.v2.1.4.js"></script>
<script type="text/javascript" src="/app/javascript/plugin/jquploadify/swfobject.js"></script>
<script type="text/javascript" src="/app/javascript/js/admin-goodsRegist.js"></script>
<script type="text/javascript" src="/app/javascript/plugin/zeroclipboard/ZeroClipboard.js"></script>
<script type="text/javascript">
$(document).ready(function() {

	{? promotion.node_text_normal }
		$(".customFontDecoration").customFontDecoration();
	{:}
		$(".customFontDecoration").customFontDecoration();
	{/}

	$(".batchExcelRegist").live("click",function(){
		$("#ExcelUploadDialog").dialog("open");
	});

	openDialog("엑셀 업로드 <span class='desc'>프로모션 코드 엑셀 등록</span>", "ExcelUploadDialog", {"width":630,"height":540,"autoOpen":false,"close":function(){
		$("#ExcelUploadButton").uploadifyCancel();
		$("#ExcelUploadButtonQueue").empty();
		$("#ExcelUploadButton").uploadifyClearQueue();
	}});

	/* 파일업로드버튼 Uploadify 적용 */
	$("#ExcelUploadButton").uploadify({
		'script'			: krdomain+'/admin/promotion_process/upload_excelfile',
	    'uploader'			: '/app/javascript/plugin/jquploadify/uploadify.swf',
	    'buttonImg'			: '../images/common/btn_filesearch.gif',
	    'cancelImg'			: '/app/javascript/plugin/jquploadify/uploadify-cancel.png',
	    'fileTypeExts'		: '*.xls',
	    'fileTypeDesc'		: 'Excel',
	    'removeCompleted'	: false,
		'width'				: 63,
		'height'			: 20,
	    'folder'			: '/data/tmp',
	    'auto'				: true,
	    'multi'				: false,
	    'onComplete'		: function (event, ID, fileObj, response, data) {
			var data = eval(response)[0];
			if(data.status){
				$("#ExcelUploadButton").uploadifyCancel();
				$("#ExcelUploadButtonQueue").empty();
				$("#ExcelUploadButton").uploadifyClearQueue();
				$("#promotion_file").val(data.file_name);
				closeDialog("ExcelUploadDialog");
			}else{
				$("#ExcelUploadButton").uploadifyCancel();
				$("#ExcelUploadButtonQueue").empty();
				$("#ExcelUploadButton").uploadifyClearQueue();
				alert(data.msg);
			}
		},
		'onError'			: function (event,ID,fileObj,errorObj) {
			alert(errorObj.type + ' Error: ' + errorObj.info);
		}
	});


	$(".promotionImg1").mouseover(function(){
		var src_orign = $(this).attr("src_orign");
		$("#promotionImg1src").attr("src",src_orign);
	});
	$(".promotionImg1").mouseout(function(){
		var src_sample = $(this).attr("src_sample");
		$("#promotionImg1src").attr("src",src_sample);
	});

	$(".batchImageRegist").live("click",function(){
		showImageUploadDialog();
		$("#imageUploadButton").uploadifySettings();
	});

	openDialog("이미지 업로드 <span class='desc'>이미지 파일을 업로드합니다.</span>", "imageUploadDialog", {"width":500,"height":300,"autoOpen":false,"close":function(){
		$("#imageUploadButton").uploadifyCancel();
		$("#imageUploadButtonQueue").empty();
		$("#imageUploadButton").uploadifyClearQueue();
	}});


	/* 파일업로드버튼 Uploadify 적용 */
	$("#imageUploadButton").uploadify({
		'script'			: krdomain+'/admin/promotion_process/upload_file',
	    'uploader'			: '/app/javascript/plugin/jquploadify/uploadify.swf',
	    'buttonImg'			: $(".imageUploadBtnImage").attr('src'),
	    'cancelImg'			: '/app/javascript/plugin/jquploadify/uploadify-cancel.png',
	    'fileTypeExts'		: '*.jpg;*.gif;*.png;*.jpeg',
	    'fileTypeDesc'		: 'Image Files (.JPG, .GIF, .PNG)',
	    'removeCompleted'	: false,
		'width'				: 63,
		'height'			: 20,
	    'folder'			: '/data/tmp',
	    'auto'				: true,
	    'multi'				: false,
	    'onComplete'		: function (event, ID, fileObj, response, data) {
			var data = eval(response)[0];
			if(data.status){
				$("#promotionimage4lay").html('');
				$("#promotion_image4").val('');
				$("#promotionimage4lay").html("<img src='"+ data.saveFile + "' /> ");
				$("#promotionimage4").val( data.file_name);
				closeDialog("imageUploadDialog");
			}else{
				$("#imageUploadButton").uploadifyCancel();
				$("#imageUploadButtonQueue").empty();
				$("#imageUploadButton").uploadifyClearQueue();
				alert(data.msg);
			}
		},
		'onError'			: function (event,ID,fileObj,errorObj) {
			alert(errorObj.type + ' Error: ' + errorObj.info);
		}
	});

	$(".promotion_code_form").click(function(){
		document.location.href = '{promotion_code_form}';
	});

	$("form#promotionRegist input[name='promotionType']").bind("click",function(){
		set_promotion_form();
	});


	$("#promotion_type2").click(function(){
		{? !promotion.promotion_seq }
			if($("#promotion_type2").attr('checked') == 'checked' ) {
				$('#promotionRegist').validate({
					onkeyup: false,
					rules: {
						promotion_input_num: { required:true , remote:{type:'post',url:'../promotion_process/offlinepromotion_ck'}},
					},
					messages: {
						promotion_input_num: { required:'<font color="red">입력해 주세요.</font>', remote: '이미 등록된 프로모션코드입니다.'},
					},
					errorPlacement: function(error, element) {
						openDialogAlert('프로모션코드가 중복되었습니다.','400','140',function(){});
					},
					submitHandler: function(f) {
						f.submit();
					}
				});
			}
		{/}
	});

	$("form#promotionRegist input[name='issue_type']").bind("click",function(){
		if($(this).val() == 'issue') {

			$('.issuetypelay').show();
			$('#issuesgoodslay').show();
			$('#issuesbrandlay').show();
			$('#exceptgoodslay').hide();
			$('#issuescategorylay').show();
			$('#exceptcategorylay').hide();
			$('#exceptbrandlay').hide();
		}else if($(this).val() == 'except'){
			$('.issuetypelay').show();
			$('#issuesgoodslay').hide();
			$('#issuesbrandlay').hide();
			$('#exceptgoodslay').show();

			$('#issuescategorylay').hide();
			$('#exceptcategorylay').show();
			$('#exceptbrandlay').show();
		}else{
			$('.issuetypelay').hide();
			$('#issuesgoodslay').hide();
			$('#issuesbrandlay').hide();
			$('#exceptgoodslay').hide();
			$('#issuescategorylay').hide();
			$('#exceptcategorylay').hide();
			$('#exceptbrandlay').hide();
		}
	});

	$("form#promotionRegist button#issueGoodsButton").bind("click",function(){
		set_goods_list("issueGoodsSelect","issueGoods");
	});
	$("#issueGoods").sortable();
	$("#issueGoods").disableSelection();

	$("form#promotionRegist button#exceptIssueGoodsButton").bind("click",function(){
		set_goods_list("exceptIssueGoodsSelect","exceptIssueGoods");
	});
	$("#exceptIssueGoods").sortable();
	$("#exceptIssueGoods").disableSelection();

	/* 카테고리 불러오기 */
	category_admin_select_load('','category1','');
	$("select[name='category1']").bind("change",function(){
		category_admin_select_load('category1','category2',$(this).val());
		category_admin_select_load('category2','category3',"");
		category_admin_select_load('category3','category4',"");
	});
	$("select[name='category2']").bind("change",function(){
		category_admin_select_load('category2','category3',$(this).val());
		category_admin_select_load('category3','category4',"");
	});
	$("select[name='category3']").bind("change",function(){
		category_admin_select_load('category3','category4',$(this).val());
	});

	$("button#issueCategoryButton").bind("click",function(){
		var obj;
		var category;
		var categoryCode;

		obj = $("select[name='category1']");
		if(obj.val()){
			category = $("select[name='category1'] option[value='"+obj.val()+"']").html();
			categoryCode = obj.val();
		}
		obj = $("select[name='category2']");
		if(obj.val()){
			category += " > " + $("select[name='category2'] option[value='"+obj.val()+"']").html();
			categoryCode = obj.val();
		}
		obj = $("select[name='category3']");
		if(obj.val()){
			category += " > " + $("select[name='category3'] option[value='"+obj.val()+"']").html();
			categoryCode = obj.val();
		}
		obj = $("select[name='category4']");
		if(obj.val()){
			category += " > " + $("select[name='category4'] option[value='"+obj.val()+"']").html();
			categoryCode = obj.val();
		}

		if(category){
			if($("input[name='issueCategoryCode[]'][value='"+categoryCode+"']").length == 0){
				var tag = "<div style='padding:5px;'><span style='display:inline-block;width:300px'>"+category+"</span>";
				tag += "<span class='btn-minus'><button type='button' class='delCategory'></button></span>";
				tag += "<input type='hidden' name='issueCategoryCode[]' value='"+categoryCode+"' /></div>";
				$("div#issueCategory").append(tag);
			}
		}
	});

	category_admin_select_load('','exceptCategory1','');
	$("select[name='exceptCategory1']").bind("change",function(){
		category_admin_select_load('exceptCategory1','exceptCategory2',$(this).val());
		category_admin_select_load('exceptCategory2','exceptCategory3',"");
		category_admin_select_load('exceptCategory3','exceptCategory4',"");
	});
	$("select[name='exceptCategory2']").bind("change",function(){
		category_admin_select_load('exceptCategory2','exceptCategory3',$(this).val());
		category_admin_select_load('exceptCategory3','exceptCategory4',"");
	});
	$("select[name='exceptCategory3']").bind("change",function(){
		category_admin_select_load('exceptCategory3','exceptCategory4',$(this).val());
	});

	$("button#exceptIssueCategoryButton").bind("click",function(){
		var obj;
		var category;
		var categoryCode;

		obj = $("select[name='exceptCategory1']");
		if( obj.val()) {
			category = $("select[name='exceptCategory1'] option[value='"+obj.val()+"']").html();
			categoryCode = obj.val();
		}
		obj = $("select[name='exceptCategory2']");
		if(obj.val()){
			category += " > " + $("select[name='exceptCategory2'] option[value='"+obj.val()+"']").html();
			categoryCode = obj.val();
		}
		obj = $("select[name='exceptCategory3']");
		if(obj.val()){
			category += " > " + $("select[name='exceptCategory3'] option[value='"+obj.val()+"']").html();
			categoryCode = obj.val();
		}
		obj = $("select[name='exceptCategory4']");
		if(obj.val()){
			category += " > " + $("select[name='exceptCategory4'] option[value='"+obj.val()+"']").html();
			categoryCode = obj.val();
		}

		if(category){
			if($("input[name='exceptIssueCategoryCode[]'][value='"+categoryCode+"']").length == 0){
				var tag = "<div style='padding:5px;'><span style='display:inline-block;width:300px'>"+category+"</span>";
				tag += "<span class='btn-minus'><button type='button' class='delCategory'></button></span>";
				tag += "<input type='hidden' name='exceptIssueCategoryCode[]' value='"+categoryCode+"' /></div>";
				$("div#exceptIssueCategory").append(tag);
			}
		}
	});



	$("form#promotionRegist button.delCategory").live("click",function(){
		$(this).parent().parent().remove();
	});
	/* 카테고리 불러오기 end */


	/* 브랜드 불러오기 */
	brand_admin_select_load('','brand1','');
	$("select[name='brand1']").live("change",function(){
		brand_admin_select_load('brand1','brand2',$(this).val());
		brand_admin_select_load('brand2','brand3',"");
		brand_admin_select_load('brand3','brand4',"");
	});
	$("select[name='brand2']").live("change",function(){
		brand_admin_select_load('brand2','brand3',$(this).val());
		brand_admin_select_load('brand3','brand4',"");
	});
	$("select[name='brand3']").live("change",function(){
		brand_admin_select_load('brand3','brand4',$(this).val());
	});

	$("button#issueBrandButton").bind("click",function(){
		var obj;
		var brand;
		var brandCode;

		obj = $("select[name='brand1']");
		if(obj.val()){
			brand = $("select[name='brand1'] option[value='"+obj.val()+"']").html();
			brandCode = obj.val();
		}
		obj = $("select[name='brand2']");
		if(obj.val()){
			brand += " > " + $("select[name='brand2'] option[value='"+obj.val()+"']").html();
			brandCode = obj.val();
		}
		obj = $("select[name='brand3']");
		if(obj.val()){
			brand += " > " + $("select[name='brand3'] option[value='"+obj.val()+"']").html();
			brandCode = obj.val();
		}
		obj = $("select[name='brand4']");
		if(obj.val()){
			brand += " > " + $("select[name='brand4'] option[value='"+obj.val()+"']").html();
			brandCode = obj.val();
		}

		if(brand){
			if($("input[name='issueBrandCode[]'][value='"+brandCode+"']").length == 0){
				var tag = "<div style='padding:5px;'><span style='display:inline-block;width:300px'>"+brand+"</span>";
				tag += "<span class='btn-minus'><button type='button' class='delbrand'></button></span>";
				tag += "<input type='hidden' name='issueBrandCode[]' value='"+brandCode+"' /></div>";
				$("div#issueBrand").append(tag);
			}
		}
	});

	brand_admin_select_load('','exceptbrand1','');
	$("select[name='exceptbrand1']").live("change",function(){
		brand_admin_select_load('exceptbrand1','exceptbrand2',$(this).val());
		brand_admin_select_load('exceptbrand2','exceptbrand3',"");
		brand_admin_select_load('exceptbrand3','exceptbrand4',"");
	});
	$("select[name='exceptbrand2']").live("change",function(){
		brand_admin_select_load('exceptbrand2','exceptbrand3',$(this).val());
		brand_admin_select_load('exceptbrand3','exceptbrand4',"");
	});
	$("select[name='exceptbrand3']").live("change",function(){
		brand_admin_select_load('exceptbrand3','exceptbrand4',$(this).val());
	});

	$("button#exceptIssueBrandButton").bind("click",function(){
		var obj;
		var brand;
		var brandCode;

		obj = $("select[name='exceptbrand1']");
		if( obj.val()) {
			brand = $("select[name='exceptbrand1'] option[value='"+obj.val()+"']").html();
			brandCode = obj.val();
		}
		obj = $("select[name='exceptbrand2']");
		if(obj.val()){
			brand += " > " + $("select[name='exceptbrand2'] option[value='"+obj.val()+"']").html();
			brandCode = obj.val();
		}
		obj = $("select[name='exceptbrand3']");
		if(obj.val()){
			brand += " > " + $("select[name='exceptbrand3'] option[value='"+obj.val()+"']").html();
			brandCode = obj.val();
		}
		obj = $("select[name='exceptbrand4']");
		if(obj.val()){
			brand += " > " + $("select[name='exceptbrand4'] option[value='"+obj.val()+"']").html();
			brandCode = obj.val();
		}

		if(brand){
			if($("input[name='exceptIssueBrandCode[]'][value='"+brandCode+"']").length == 0){
				var tag = "<div style='padding:5px;'><span style='display:inline-block;width:300px'>"+brand+"</span>";
				tag += "<span class='btn-minus'><button type='button' class='delbrand'></button></span>";
				tag += "<input type='hidden' name='exceptIssueBrandCode[]' value='"+brandCode+"' /></div>";
				$("div#exceptIssuebrand").append(tag);
			}
		}
	});



	$("form#promotionRegist button.delBrand").live("click",function(){
		$(this).parent().parent().remove();
	});
	/* 브랜드 불러오기 end  */

	<!--{?  promotion.type == 'promotion'  || promotion.type == 'promotion_shipping' }-->
		$("input[name='promotionType'][value='promotion']").attr('checked',true);
	<!--{: promotion.type == 'admin'  || promotion.type == 'admin_shipping'  }-->
		$("input[name='promotionType'][value='admin']").attr('checked',true);
	<!--{: promotion.type == 'point'  || promotion.type == 'point_shipping' }-->
		$("input[name='promotionType'][value='point']").attr('checked',true);
	<!--{/}-->

	<!--{ ? promotion.download_limit }-->
	$("form#promotionRegist select[name='downloadLimit_{promotion.type}']").val(['{promotion.download_limit}']);
	<!--{/}-->

	<!--{ ? promotion.download_limit_ea }-->
	$("form#promotionRegist input[name='downloadLimitEa_{promotion.type}']").val('{promotion.download_limit_ea}');
		{? promotion.download_limit == 'limit' //누적제한 }
			$("form#promotionRegist input[name='downloadLimitEa_{promotion.type}']").show();
		<!--{/}-->
	<!--{/}-->

	$("input[name='saleType'][value='{promotion.sale_type}']").attr("checked",true);

	<!--{ ? promotion.download_limit }-->
		$("input[name='downloadLimit_promotion'][value='{promotion.download_limit}']").attr('checked',true);
		$("#downloadLimitEa_promotion").val('{promotion.download_limit_ea}');
	<!--{/}-->

	<!--{ ? promotion.downloadLimit_member }-->
		$("input[name='downloadLimit_member'][value='{promotion.downloadLimit_member}']").attr('checked',true);
	<!--{/}-->

	<!--{ ? promotion.mainshow }-->
		$("input[name='mainshow'][value='{promotion.mainshow}']").attr('checked',true);
	<!--{/}-->



	<!--{ ? promotion.issue_type }-->
		$("input[name='issue_type'][value='{promotion.issue_type}']").attr('checked',true);
		<!--{ ? promotion.issue_type == 'issue' }-->

			$('.issuetypelay').show();
			$('#issuesgoodslay').show();
			$('#exceptgoodslay').hide();
			$('#issuescategorylay').show();
			$('#issuesbrandlay').show();
			$('#exceptcategorylay').hide();
			$('#exceptbrandlay').hide();
		<!--{: promotion.issue_type == 'except' }-->

			$('.issuetypelay').show();
			$('#issuesgoodslay').hide();
			$('#exceptgoodslay').show();
			$('#issuescategorylay').hide();
			$('#issuesbrandlay').hide();
			$('#exceptcategorylay').show();
			$('#exceptbrandlay').show();
		<!--{:}-->
			$('.issuetypelay').hide();
			$('#issuesgoodslay').hide();
			$('#exceptgoodslay').hide();
			$('#issuescategorylay').hide();
			$('#issuesbrandlay').hide();
			$('#exceptcategorylay').hide();
			$('#exceptbrandlay').hide();
		<!--{/}-->
	<!--{/}-->


	<!--{ ? promotion.duplication_use==1 }-->
	$("form#promotionRegist input[name='duplicationUse']").val(['{promotion.duplication_use}']);
	<!--{/}-->
	<!--{ ? promotion.promotion_img }-->
		$("input[name='promotionImg'][value='{promotion.promotion_img}']").attr('checked',true);
	<!--{/}-->

	$("input[name='issuePriodType'][value='{promotion.issue_priod_type}']").attr("checked",true);

	set_promotion_form();

	// 발급/사용내역
	$('.downloadlist_btn').live('click', function() {
		//if ( $(this).val() > 0 ) {
			var promotion_seq = $(this).attr("promotion_seq");
			var promotion_name = $(this).attr("promotion_name");
			addFormDialog('./download?no='+promotion_seq, '93%', '600', '['+promotion_name+'] 발급/사용내역 ','false');
		//}
	});

	// 발급/사용내역
	$('.downloadlistuse_btn').live('click', function() {
		var promotion_seq = $(this).attr("promotion_seq");
		var promotion_name = $(this).attr("promotion_name");
		addFormDialog('./download?use_status=used&no='+promotion_seq,'93%', '600', '['+promotion_name+'] 발급/사용내역 ','false');
	});

	//수동생성 > 프로모션 코드보기
	$('#promotion_code_view').live('click', function() {
		addFormDialog('./promotion_code?no={promotion.promotion_seq}', '480', '750', '[{promotion.promotion_name}] 프로모션 코드 보기 ','false');
	});

	//수동생성 > 프로모션 코드 엑셀 다운받기
	$('#promotion_code_excel_down').live('click', function() {
		document.location.href='../promotion_process/promotion_code_exceldown?no={promotion.promotion_seq}';
	});

	$("#downloadLimit_promotion").click(function(){
		if($(this).attr('checked') == 'checked' ) {
			 $(".downloadLimitlay").removeClass('gray');
			$("#downloadLimitEa_promotion").removeAttr("disabled");
		}else{
			$(".downloadLimitlay").addClass('gray');
			$("#downloadLimitEa_promotion").attr("disabled","disabled");
		}
	});


	$("#saleType_percent").click(function(){
		$(".duplicationUsetitle").removeClass('gray');
		$("#duplicationUse").removeAttr("disabled");
		$("#saleType_percent").attr('checked',true);
		$("#issueexceptlay").show();
	});

	$("#saleType_won").click(function(){
		$(".duplicationUsetitle").removeClass('gray');
		$("#duplicationUse").removeAttr("disabled");
		$("#saleType_won").attr('checked',true);
		$("#issueexceptlay").show();
	});

	$("#saleType_shipping_free").click(function(){
		$("#duplicationUse").attr("disabled","disabled");
		$(".duplicationUsetitle").addClass('gray');
		$(".duplicationuselay").addClass('gray');
		$("#saleType_shipping_free").attr('checked',true);
		$("#issueexceptlay").hide();
	});

	$("#saleType_shipping_won").click(function(){
		$("#duplicationUse").attr("disabled","disabled");
		$(".duplicationUsetitle").addClass('gray');
		$(".duplicationuselay").addClass('gray');
		$("#saleType_shipping_won").attr('checked',true);
		$("#issueexceptlay").hide();
	});

	$("input[name='duplicationUse']").click(function(){
		if($(this).attr('checked') == 'checked' ) {
			$("input[name='duplicationUse']").attr('checked',true);
			$(".duplicationuselay").removeClass('gray');
		}else{
			$("input[name='duplicationUse']").attr('checked',false);
			$(".duplicationuselay").addClass('gray');
		}
	});

	$(".issuePriodType0").click(function(){
		$("#issuePriodType0").attr('checked',true);
	});

	$(".issuePriodType1").click(function(){
		$("#issuePriodType1").attr('checked',true);
	});

	$(".promotiontbllay").click(function(){
		$("#promotionType_promotion").attr('checked',true);
		set_promotion_form();
	});

	$(".admintbllay").click(function(){
		$("#promotionType_admin").attr('checked',true);
		set_promotion_form();
	});

	$(".pointtbllay").click(function(){
		$("#promotionType_point").attr('checked',true);
		set_promotion_form();
	});

	$('body,input,textarea,select').bind('keydown','Ctrl+s',function(event){
		event.preventDefault();
		$("#promotionRegist").submit();
	});

	// 발급하기
	$('.downloa_write_btn').live('click', function() {
		$("#write_no").val();
		$("input[type='checkbox'][name='memberGroup']:checked").each(function(){
			$(this).attr("checked",false);
		});
		$("#target_type3").attr("checked","checked");
		$("#groupsMsg").html('');
		$("#target_container").html('');
		$("#member_search_count").html(0);
		var promotion_seq = $(this).attr("promotion_seq");
		var promotion_name = $(this).attr("promotion_name");
		$("#write_no").val(promotion_seq);
		$("#write_promotion_name").val(promotion_name);
		$.ajax({
			'url' : '../promotion_process/download_promotion_info',
			'data' : {'promotionSeq':promotion_seq},
			'type' : 'post',
			'dataType': 'json',
			'success' : function(data){
				$('#downloadmbtotalcountlay').html(data.downloadmbtotalcountlay);
				if( data.promotion.type != 'promotion_point' ) {
					var dlwrite_1 = data.promotion.limit_goods_price+"원 이상 구매 시&nbsp";
				}else{
					var dlwrite_1 = "";
				}

				$('#dlwrite_1').html(dlwrite_1);
				$('#dlwrite_2').html(data.promotion.issuedate);
				$('#dlwrite_3').html(data.promotion.salepricetitle);
				$('#dlwrite_4').html(data.downusecountlay);
			}
		});
		var download_limit = $(this).attr('download_limit');//전체회원수
		if(download_limit == 'limit'){//누적제한인경우
			$("#target_type3").attr("checked","checked");
			$("#target_type1").attr("disabled","disabled");
			$("#target_type2").attr("disabled","disabled");
		}else{
			$("#target_type3").attr("checked","checked");
			$("#target_type1").removeAttr("disabled");
			$("#target_type2").removeAttr("disabled");
		}

		$("#target_member").val('');//초기화
		openDialog("["+promotion_name+"] 발급하기 <span class='desc'>발급대상을 선택합니다.</span>", "downloadwrite", {"width":"950","height":550});
	});

	// 프로모션발급 발급대상 클릭시
    $("input:radio[name='target_type']").click(function() {
		var promotion_name = $("#write_promotion_name").val();
        if($(this).val()== 'all') {
			$("#target_type1").attr("checked","checked");
            $("#target_container").html('');
			$("#target_member").val('');
            $("#member_search_count").html(0);
			$("#groupsMsg").html('');
        } else if($(this).val() == 'group') {
			$("#target_type2").attr("checked","checked");
            $("#target_container").html('');
			$("#target_member").val('');
            $("#member_search_count").html(0);

        } else if($(this).val() == 'member') {
			$("#target_type3").attr("checked","checked");
			$("#groupsMsg").html('');
        }
    });

	//발급대상 선택하기
	$('.download_member_search').live('click', function() {
		$("#target_type3").attr("checked","checked");
		var promotion_name = $("#write_promotion_name").val();
		promotion_member_search(promotion_name);//회원검색
	});

	$("#download_group_search").live("click",function(){
		if($("#target_type2").attr("disabled") != 'disabled'){
			$("#target_type2").attr("checked","checked");
			var checkedId = "input:checkbox[name='memberGroup']";
			var idx = ($(checkedId).length);;
			if(idx > 0) {
				$(checkedId).each(function(e, data) {
					if( !downloadmembergroup($(data).val()) ) {//다운권한이 없는 등급인 경우
						$("#memberGroup_"+$(data).val()).attr("disabled","disabled");
					}else{
						$("#memberGroup_"+$(data).val()).removeAttr("disabled");
					}
				});
			}
			openDialog("회원그룹 <span class='desc'>프로모션발급할 회원그룹을 선택합니다.</span>", "setGroupsPopup", {"width":"500","height":150});
		}
	});


	$('#display_quantity').bind('change', function() {
		$("#perpage").val($(this).val());
		$("#promotionsearch").submit();
	});

	$('#display_orderby').bind('change', function() {
		$("#orderby").val($(this).val());
		$("#promotionsearch").submit();
	});


	$(".orderview").click(function(){
		var order_seq = $(this).attr("order_seq");
		var href = "/admin/order/view?no="+order_seq;
		var a = window.open(href, 'orderdetail'+order_seq, '');
		if ( a ) {
			a.focus();
		}
	});

	$(".goodsview").click(function(){
		var goods_seq = $(this).attr("goods_seq");
		var href = "/admin/goods/regist?no="+goods_seq;
		var a = window.open(href, 'goodsdetail'+goods_seq, '');
		if ( a ) {
			a.focus();
		}
	});

	$(".userinfo").click(function(){
		var mseq = $(this).attr("mseq");
		var href = "/admin/member/detail?member_seq="+mseq;
		var a = window.open(href, 'mbdetail'+mseq, '');
		if ( a ) {
			a.focus();
		}
	});

	{? promotion.promotion_seq && (promotion.promotion_type == 'one' || promotion.promotion_type == 'input') }
		var promotion_input_serialnumber =  $("#promotion_code_copy").attr('promotion_input_serialnumber');
		tagCopyClips = new ZeroClipboard.Client();
		tagCopyClips.setHandCursor( true );
		tagCopyClips.setCSSEffects( true );
		tagCopyClips.setText(promotion_input_serialnumber);
		tagCopyClips.addEventListener( 'complete', function(client, text) {
			alert("프로모션코드가 복사되었습니다.\nCtrl+V로 붙여넣기 하세요.");
		} );
		tagCopyClips.glue('promotion_code_copy');
	{/}


	$(".setGroup").live("click",function(){
		$("input:checkbox[name='memberGroup']").attr("checked",false);
		openDialog("접속제한 <span class='desc'>회원그룹을 설정합니다.</span>", "setGroupsPopup", {"width":"500","height":150});
	});

	$("input[name=memberGroup]").live("click",function(){
		var type = $("form#onlineRegist input[name='couponType']:checked").val();
		groupsMsg(type);
	});

	$("input[name='maxPercentShippingSale']").focus(function(){
		$("#saleType_shipping_free").trigger("click");
	});

	$("input[name='wonShippingSale']").focus(function(){
		$("#saleType_shipping_won").trigger("click");
	});
});

function set_promotion_form(){
	$("form#promotionRegist input[name='promotionType']:checked").each(function(){
		$(".promotion, .point, .admin").hide();
		$("."+$(this).val()).show();

		if($(this).attr('checked') == 'checked' && $(this).val() == 'promotion') {
			$("#promotion_type1").val('one');
			$("#promotion_type2").val('input');
		}else{
			$("#promotion_type1").val('random');
			$("#promotion_type2").val('file');
		}
		{? !promotion.promotion_seq}
			$("input:radio[name='issuePriodType']").eq(0).attr("checked","checked");
		<!--{/}-->
	});
}
function set_goods_list(displayId,inputGoods){
	$.ajax({
		type: "get",
		url: "../goods/select",
		data: "page=1&inputGoods="+inputGoods+"&displayId="+displayId,
		success: function(result){
			$("div#"+displayId).html(result);
		}
	});
	openDialog("상품 검색", displayId, {"width":"1000","height":"700","show" : "fade","hide" : "fade"});
}
function regist_category(targetCategory){
	$("div#categoryDialog input[name='targetCategory']").val(targetCategory);
	openDialog("카테고리 등록", "categoryDialog", {"width":900,"height":300});
}


function promotion_member_search(promotion_name){
	var no  = $("#write_no").val();
	addFormDialogSel('./download_member?no='+no, '85%', '750', '['+promotion_name+'] 프로모션발급하기 > 회원검색 ');
}

function addFormDialogSel(url, width, height, title, btn_yn) {
	newcreateElementContainer(title);
	newrefreshTable(url);
	$('#dlg').dialog({
		bgiframe: true,
		autoOpen: false,
		width: width,
		height: height,
		resizable: false,
		draggable: false,
		modal: true,
		overlay: {
			backgroundColor: '#000000',
			opacity: 0.8
		},
		buttons: {
			'닫기': function() {
				$(this).dialog('close');
			},
			'검색된 회원적용': function() {
				var queryString = $('#downloadsearch').formSerialize();
				$.ajax({
					type: 'post',
					url: '/admin/promotion_process/download_member_search_all',
					data: queryString,
					dataType: 'json',
					success: function(data) {
						var checkedId = "input:checkbox[name$='member_chk[]']:checked";
						var oldstr = $("#target_container").html();
						var target_member = $("#target_member").val();
						var addnum = 0;
						var str = "";
						var tag = "";

						var downloadtotal = $("#downloadtotal").val();////현재 발급건수
						var download_limit_ea = $("#download_limit_ea").val();//누적건수
						var member_search_count = ($("#member_search_count").html());//총선택회원수
						var download_limit = $("#download_limit").val();//수량제한구분

						if(data.totalcnt>0) {
							for(i=0;i<data.totalcnt;i++) {
								var member_seq = data.searchallmember[i]['member_seq'];
								var userid = data.searchallmember[i]['userid'];
								var user_name = data.searchallmember[i]['user_name'];
								if( memberselectck(member_seq) == false ) {
									addnum++;
									str += user_name+'[' + userid + '] , ';
									tag += '['+member_seq+'],';
								}
							}
						}
						if(str){
							var msg = oldstr + " " + str;
							$("#target_container").html(msg);
							$("#target_member").val(target_member + tag)
							var newcheckedId = $("#target_member").val().split(',');
							$("#member_search_count").html((newcheckedId.length-1));
						}
					}
				});
				$(this).dialog('close');
			},
			'선택된 회원적용': function() {
				var str = "";
				var tag = "";
				var oldstr = $("#target_container").html();
				var target_member = $("#target_member").val();
				var checkedId = "input:checkbox[name$='member_chk[]']:checked";
				var idx = ($(checkedId).length);//현재회원수
				var addnum = 0;
				if(idx > 0) {

					var downloadtotal = $("#downloadtotal").val();////현재 발급건수
					var download_limit_ea = $("#download_limit_ea").val();//누적건수
					var member_search_count = parseInt($("#member_search_count").html());//총선택회원수
					var download_limit = $("#download_limit").val();//수량제한구분
					if(download_limit == 'limit'){
							var downloadtotal1 = parseInt(parseInt(downloadtotal)+parseInt(idx));
							var downloadtotal2 = parseInt(parseInt(downloadtotal1)+parseInt(member_search_count));
						if(idx > download_limit_ea ){
							alert("이 프로모션코드의 전체수량제한 누적건수("+download_limit_ea+")보다 현재 선택회원("+idx+")이 많습니다!");
							return false;
						}else if(downloadtotal1 > download_limit_ea ){
							alert("이 프로모션코드의 전체수량제한 누적건수("+download_limit_ea+")보다 총 발급건수와 현재 선택회원의 합계("+downloadtotal1+")가 많습니다!");
							return false;
						}else if(downloadtotal2 > download_limit_ea ){
							alert("이 프로모션코드의 전체수량제한 누적건수("+download_limit_ea+")보다 총 발급건수와 총 선택회원의 합계("+downloadtotal2+")가 많습니다!");
							return false;
						}
					}

					$(checkedId).each(function(e, data) {
						if( memberselectck($(this).val()) == false ) {addnum++;
							str += $(this).attr("user_name")+'[' + $(this).attr("userid") + '] , ';
							tag += '['+$(this).val()+'],';
						}
					});
				}

				if(str){
					var msg = oldstr + " " + str;
					$("#target_container").html(msg);
					$("#target_member").val(target_member + tag)
					var newcheckedId = $("#target_member").val().split(',');
					$("#member_search_count").html((newcheckedId.length-1));
				}
				$(this).dialog('close');
			}
		}
	}).dialog('open');
	return false;
}

function groupsMsg(){
	var str = "";
	var tag = "";
	$("#groupsMsg").html("");
	$("input[type='checkbox'][name='memberGroup']:checked").each(function(){
		var clone = $(this).parent().clone();
		clone.find("input").remove();
		str += clone.html() + ' , ';
		tag += "<input type='hidden' name='memberGroups[]' value='"+$(this).val()+"'>";
	});
	if(str){
		var msg = "이 프로모션코드의 발급그룹은 <strong>" + str.substr(0,str.length-3) + "</strong> 입니다." + tag;
		$("#groupsMsg").html(msg);
	}
}

//프로모션코드의 다운로드 등급설정시 추가
function downloadmembergroup(newgroup) {
	var returns = false;
	var newcheckedId = "input[name$='download_memberGroups[]']";
	var newidx = ($(newcheckedId).length);
	if(newidx > 0) {
		$(newcheckedId).each(function(e, newdata) {
			if( parseInt(newgroup) == parseInt($(newdata).val()) ) {
				returns = true;
				return false;
			}
		});
	}else{
		returns = true;
	}
	return returns;
}


//프로모션코드 엑셀등록
function offlineexcelsave(promotion_seq)
{
	var promotion_name = $("#promotion_name").val();
	var filename = $("#promotion_file").val();
	addExcelFormDialog('./promotion_excel?filename='+ filename +'&no='+promotion_seq, '45%', '800', '['+promotion_name+'] 프로모션코드 일괄등록 ','false',promotion_seq);
}


/**
 * 신규생성 다이얼로그 창을 띄운다.
 * <pre>
 * 1. createElementContainer 함수를 이용하여 매번 div 태그를 입력하지 않고 다이얼로그 생성시 자동으로 생성한다.
 * 2. refreshTable 함수를 이용하여 다이얼로그 내용 부분을 불러온다.
 * </pre>
 * @param string url 폼화면 주소
 * @param int width 가로 사이즈
 * @param int height 세로 사이즈
 * @param string title 제목
 * @param string btn_yn 'false'이면 닫기버튼만 나타낸다.
 */
function addExcelFormDialog(url, width, height, title, btn_yn, promotion_seq) {
	newcreateElementContainer(title);
	newrefreshTable(url);

	if (btn_yn != 'false') {
		var buttons = {
			'닫기': function() {
				$(this).dialog('close');
			},
			'저장하기': function() {
				$('#form1').submit();
			}
		}
	}
	else if (btn_yn == 'close') {
		var buttons =  {
			'닫기': function() {
				document.location.href='./regist?no='+promotion_seq;
			}
		}
	}

	$('#dlg').dialog({
		bgiframe: true,
		autoOpen: false,
		width: width,
		height: height,
		resizable: false,
		draggable: false,
		modal: true,
		overlay: {
			backgroundColor: '#000000',
			opacity: 0.8
		},
		buttons: buttons,
		open: function() {
				$("#ui-datepicker-div").css("z-index",
				$(this).parents(".ui-dialog").css("z-index")+1);
		},
		close: function() {
			document.location.href='./regist?no='+promotion_seq;
		}
	}).dialog('open');
	return false;
}
</script>

<link rel="stylesheet" href="/app/javascript/plugin/codemirror/lib/codemirror.css">
<link rel="stylesheet" href="/app/javascript/plugin/codemirror/lib/util/dialog.css">
<link rel="stylesheet" href="/app/javascript/plugin/codemirror/theme/cobalt.css">
<script src="/app/javascript/plugin/codemirror/lib/codemirror.js"></script>
<script src="/app/javascript/plugin/codemirror/mode/xml/xml.js"></script>
<script src="/app/javascript/plugin/codemirror/mode/javascript/javascript.js"></script>
<script src="/app/javascript/plugin/codemirror/lib/util/dialog.js"></script>
<script src="/app/javascript/plugin/codemirror/lib/util/search.js"></script>
<script src="/app/javascript/plugin/codemirror/lib/util/searchcursor.js"></script>
<script src="/app/javascript/plugin/codemirror/mode/css/css.js"></script>
<script src="/app/javascript/plugin/codemirror/mode/htmlmixed/htmlmixed.js"></script>
<script src="/app/javascript/plugin/codemirror/mode/htmlembedded/htmlembedded.js"></script>

<script>
var originalSourceTextareaObj;
var originalSourceTextareaObjall;
$(function(){

	// Textarea Obj
	var originalSourceTextareaObjall = document.getElementById("originalSourceTextareaall");
	originalSourceEditorObjall = CodeMirror.fromTextArea(originalSourceTextareaObjall, {
		mode: "default",
		lineNumbers: true,
		lineWrapping :true,
		theme: 'cobalt',
		onCursorActivity: function() {
			originalSourceEditorObjall.setLineClass(originalSourceEditorActiveLineall, null);
			originalSourceEditorActiveLineall = originalSourceEditorObjall.setLineClass(originalSourceEditorObjall.getCursor().line, "originalSourceEditorActiveLineall");
		},
		onKeyEvent: function(editor, e){
			if(!e.ctrlKey && e.keyCode!=122) e.target.blur();
		}
	});

	// 커서라인 강조
	var originalSourceEditorActiveLineall = originalSourceEditorObjall.setLineClass(0, "originalSourceEditorActiveLineall");

	// Textarea Obj
	var originalSourceTextareaObj = document.getElementById("originalSourceTextarea");
	originalSourceEditorObj = CodeMirror.fromTextArea(originalSourceTextareaObj, {
		mode: "default",
		lineNumbers: true,
		lineWrapping :true,
		theme: 'cobalt',
		onCursorActivity: function() {
			originalSourceEditorObj.setLineClass(originalSourceEditorActiveLine, null);
			originalSourceEditorActiveLine = originalSourceEditorObj.setLineClass(originalSourceEditorObj.getCursor().line, "originalSourceEditorActiveLine");
		},
		onKeyEvent: function(editor, e){
			if(!e.ctrlKey && e.keyCode!=122) e.target.blur();
		}
	});

	// 커서라인 강조
	var originalSourceEditorActiveLine = originalSourceEditorObj.setLineClass(0, "originalSourceEditorActiveLine");

	var tagCopyClips = [];
	tagCopyClips[0] = new ZeroClipboard.Client();
	tagCopyClips[0].setHandCursor( true );
	tagCopyClips[0].setCSSEffects( true );
	tagCopyClips[0].addEventListener( 'complete', function(client, text) {
		alert("소스가 복사되었습니다.\nHTML소스의 원하시는 위치에 Ctrl+V로 붙여넣기 하세요.");
	} );
	tagCopyClips[0].setText($("#originalSourceTextareaallorgin").val());
	tagCopyClips[0].glue('promocodeallhtml_btn');

	tagCopyClips[1] = new ZeroClipboard.Client();
	tagCopyClips[1].setHandCursor( true );
	tagCopyClips[1].setCSSEffects( true );
	tagCopyClips[1].addEventListener( 'complete', function(client, text) {
		alert("소스가 복사되었습니다.\nHTML소스의 원하시는 위치에 Ctrl+V로 붙여넣기 하세요.");
	} );
	tagCopyClips[1].setText($("#originalSourceTextareaorgin").val());
	tagCopyClips[1].glue('promocodehtml_btn');



});

</script>


<style type="text/css">
	.CodeMirror {border-top: 1px solid black; border-bottom: 1px solid black;}
	.CodeMirror-scroll {
		display: block;
		position: absolute;
		top: 0px;
		left: 0px;
		width: 100%;
		height: 100%;
		z-index: 9999 !important;
		border: 0px;
		background-color:#112435;
	}

	.originalSourceEditorActiveLine {background: #003355 !important;}
	.originalSourceEditorActiveLineall {background: #003355 !important;}

	#originalSourceTextareaContainerall {position:relative; width:100%; height:410px;}
	#originalSourceTextareaContainer {position:relative; width:100%; height:230px;}

</style>


<!--{ ? promotion.promotion_seq }-->
<form name="promotionRegist" id="promotionRegist" method="post" enctype="multipart/form-data" action="../promotion_process/promotion_modify" target="actionFrame">
<input type="hidden" name="promotionSeq" value="{promotion.promotion_seq}" />
<!--{ : }-->
<form name="promotionRegist" id="promotionRegist" method="post" enctype="multipart/form-data" action="../promotion_process/promotion" target="actionFrame">
<!--{/}-->

<!-- 페이지 타이틀 바 : 시작 -->
<div id="page-title-bar-area"  class="gray-bar">
	<div id="page-title-bar">
		<!-- 좌측 버튼 -->
		<ul class="page-buttons-left">
			<li><span class="btn large white"><button type="button" onclick="document.location.href='../promotion/catalog';">프로모션 코드 리스트<span class="arrowright"></span></button></span></li>
		</ul>

		<!-- 타이틀 -->
		<div class="page-title">
			<h2>프로모션코드 { ? promotion.promotion_seq }수정{:}만들기<!--{/}--> </h2>
		</div>
		<!-- 우측 버튼 -->
		{? promotion.downloadtotal < 1 }
		<ul class="page-buttons-right">
			{? adminissuebtn } <li><span class="btn large cyanblue" ><button type="button" class="downloa_write_btn " promotion_seq="{promotion.promotion_seq}" download_limit="{promotion.download_limit}" promotion_name="{promotion.promotion_name}"  style="background-position:0 -850px;color:#FFF !important;" >발급하기</button></span></li> <!--{/}-->


			{? _GET.no }
			<li><span class="btn large black"><input type="button" class="downloadlist_btn" promotion_seq="{promotion.promotion_seq}" promotion_name="{promotion.promotion_name}" value="발급 [{promotion.downloadtotalbtn}건] / 사용 [{promotion.usetotalbtn}건]" /></span> </li>
			<!--{/}-->
			{? service_code=='P_FREE' || service_code=='P_STOR' }
				<li>홈페이지샵 / 무료몰 Plus+ 에서는 해당기능이 지원되지 않습니다.<span class="btn large cyanblue" style="display:inline-block;overflow:visible;position:relative;margin:0;padding:0;border:0;background:url('../images/common/btnBg.gif') no-repeat;font-size:12px;font-family:'dotum';color:#333 !important;text-decoration:none !important;vertical-align:middle;white-space:nowrap;cursor:pointer;padding-right:1px; background-position:right -200px;height:30px;"><input type="button" onclick="serviceUpgrade();" value="업그레이드 >"></span></span></li>
				<li><span class="btn large gray"><button type="button" >저장하기<span class="arrowright"></span></button></span></li>
			{:}
				<li><span class="btn large black"><button type="submit">저장하기<span class="arrowright"></span></button></span></li>
			{/}
		</ul>
		<!--{/}-->
	</div>
</div>

<div style="height:20px;"></div>
<div class="item-title">프로모션 코드 종류 <span class="desc" style="font-weight:normal">포인트 전환용 개별 코드는 설정 > <a href="{ispointurl}"><span class=" highlight-link hand" >적립금/포인트/이머니</span></a>에서 포인트 사용 시에만 생성 가능합니다.</div>
<table class="info-table-style" style="width:100%">
<colgroup>
	<col width="10%" />
	<col width="8%" />
	<col width="6%" />
	<col width="35%" />
	<col width="16%" />
</colgroup>
<thead>
<tr>
	<th class="its-th-align center">종류</th>
	<th class="its-th-align center" >혜택</th>
	<th class="its-th-align center" >배포 방법</th>
	<th class="its-th-align center" >특징</th>
	<th class="its-th-align center" >사용 예시</th>
</tr>
</thead>
<tbody>
<!--{? promotion.promotion_seq  }-->
	<!--{?  promotion.type == 'promotion'  || promotion.type == 'promotion_shipping' }-->
	<tr  class="promotiontbllay" >
		<td class="its-td"><label><input type="radio" name="promotionType"   id="promotionType_promotion" value="promotion"  /> <span class="bold">일반 코드(공용)</span></label></td>
		<td class="its-td left">할인 또는 배송비</td>
		<td class="its-td left">공개</td>
		<td class="its-td left">유효기간 내 동일 코드로 누구나 주문이 가능(여러 번 사용 가능), 단 주문당 1개의 코드만 사용</td>
		<td class="its-td left">
		홍길동 고객 일반 코드로 주문이 가능(O)<br/>
		이순신 고객 일반 코드로 주문이 가능(O)<br/>
		</td>
	</tr>
	<!--{: promotion.type == 'admin'  || promotion.type == 'admin_shipping'  }-->
	<tr  class="admintbllay" >
		<td class="its-td"><label><input type="radio" name="promotionType"   id="promotionType_admin" value="admin"  /> <span class="bold">개별 코드(1회성)</span></label></td>
		<td class="its-td left">할인 또는 배송비</td>
		<td class="its-td left">관리자 지급</td>
		<td class="its-td left">유효기간 내 개별 코드로 단  한 번만 주문이 가능. 단 주문당 1개의 코드만 사용</td>
		<td class="its-td left">
		홍길동 고객 개별 코드로 주문이 가능(O)<br/>
		이순신 고객 개별 코드로 주문이 불가(X)<br/>
		</td>
	</tr>
	<!--{: promotion.type == 'point'  || promotion.type == 'point_shipping' }-->
	<tr  class="pointtbllay" >
		<td class="its-td"><label><input type="radio" name="promotionType"   id="promotionType_point" value="point"  /> <span class="bold">개별 코드(1회성)</span></label></td>
		<td class="its-td left">할인 또는 배송비</td>
		<td class="its-td left">포인트 전환</td>
		<td class="its-td left">유효기간 내 개별 코드로 단  한 번만 주문이 가능. 단 주문당 1개의 코드만 사용</td>
		<td class="its-td left">
		홍길동 고객 개별 코드로 주문이 가능(O)<br/>
		이순신 고객 개별 코드로 주문이 불가(X)<br/>
		</td>
	</tr>
	<!--{/}-->

<!--{:}-->

<tr  class="promotiontbllay" >
	<td class="its-td"><label><input type="radio" name="promotionType"   id="promotionType_promotion" value="promotion" checked="checked" /> <span class="bold">일반 코드(공용)</span></label></td>
	<td class="its-td left">할인 또는 배송비</td>
	<td class="its-td left">공개</td>
	<td class="its-td left">유효기간 내 동일 코드로 누구나 주문이 가능(중복 사용 허용), 단 주문당 1개의 코드만 사용</td>
	<td class="its-td left">
	홍길동 고객 일반 코드로 주문이 가능(O)<br/>
	이순신 고객 일반 코드로 주문이 가능(O)<br/>
	</td>
</tr>
<tr  class="admintbllay" >
	<td class="its-td"><label><input type="radio" name="promotionType"   id="promotionType_admin" value="admin"  /> <span class="bold">개별 코드(1회성)</span></label></td>
	<td class="its-td left">할인 또는 배송비</td>
	<td class="its-td left">관리자 지급</td>
	<td class="its-td left">유효기간 내 개별 코드로 단  한 번만 주문이 가능. 단 주문당 1개의 코드만 사용</td>
	<td class="its-td left">
	홍길동 고객 개별 코드로 주문이 가능(O)<br/>
	이순신 고객 개별 코드로 주문이 불가(X)<br/>
	</td>
</tr>
<!--{? isplusfreenot && isplusfreenot.ispoint }-->
<tr  class="pointtbllay" >
	<td class="its-td"><label><input type="radio" name="promotionType"   id="promotionType_point" value="point"  /> <span class="bold">개별 코드(1회성)</span></label></td>
	<td class="its-td left">할인 또는 배송비</td>
	<td class="its-td left">포인트 전환</td>
	<td class="its-td left">유효기간 내 개별 코드로 단  한 번만 주문이 가능. 단 주문당 1개의 코드만 사용</td>
	<td class="its-td left">
	홍길동 고객 개별 코드로 주문이 가능(O)<br/>
	이순신 고객 개별 코드로 주문이 불가(X)<br/>
	</td>
</tr>
<!--{/}-->
<!--{/}-->
</tbody>
</table>

<div class="point " >
	<div style="height:20px;"></div>
	<div class="item-title">전환 포인트 설정</div>
	<table class="info-table-style" style="width:100%" >
		<colgroup>
		<col width="15%" />
		<col />
	</colgroup>
	<tbody>
		<tr >
			<th class="its-th ">전환포인트</th>
			<td class="its-td" >
			<input type="text" name="promotion_point" size="5" class="line onlynumber " value="{promotion.promotion_point}" />P </label>
			<span class="desc">프로모션 코드 교환시 입력한 포인트만큼 차감됩니다.</span>
			</td>
		</tr>
	</tbody>
	</table>
</div>

<div style="height:20px;"></div>
<div class="item-title">기본정보</div>
<table class="info-table-style" style="width:100%" >
<colgroup>
	<col width="20%"/>
	<col width="34%"/>
	<col width="15%"/>
	<col width="35%"/>
</colgroup>
<tbody>
<tr>
	<th class="its-th-align left pdl10">생성일</th>
	<td class="its-td" >
		<!--{? promotion.regist_date }-->{promotion.regist_date}<!--{:}-->{=date("Y-m-d H:i:s")}<!--{/}-->
	</td>
	<th class="its-th-align left pdl10">수정일</th>
	<td class="its-td">
		<!--{? promotion.update_date }-->{promotion.update_date}<!--{:}-->{=date("Y-m-d H:i:s")}<!--{/}-->
	</td>
</tr>

<tr>
	<th class="its-th-align left pdl10">프로모션 코드명</th>
	<td class="its-td">
	<!--{? promotion.downloadtotal > 0 }-->
		{promotion.promotion_name}
	<!--{:}-->
		<input type="text" class="line" name="promotionName" id="promotion_name" value="{promotion.promotion_name}" />
	<!--{/}-->
	</td>
	<th class="its-th-align left pdl10">프로모션 코드 설명</th>
	<td class="its-td">
	<!--{? promotion.downloadtotal > 0 }-->
		<!--{promotion.promotion_desc}-->
	<!--{:}-->
		<input type="text" class="line" size="50" name="promotionDesc" value="{promotion.promotion_desc}" />
	<!--{/}-->
	</td>
</tr>

<tr>
	<th class="its-th-align left pdl10"  >프로모션 코드	</th>
	<td class="its-td" colspan="3">
	{? promotion.promotion_seq  }
		<table class="info-table-style" style="width:100%">
		{? promotion.promotion_type == 'random' || promotion.promotion_type == 'one' }
		<tr>
			<th class="its-th">자동 생성</th>
			<td  class="its-td" >
				{? promotion.promotion_type == 'random' }
					<input type="hidden" name="promotion_type" value="random" >
					<div class="promotion_type1"  style="padding:5px 0 0 0;">
						랜덤한 4-4-4-4자리의 프로모션 코드 [총 {=number_format(promotion.filepromotiontotal)}건]
						<span class="btn small valign-middle cyanblue"><input type="button" id="promotion_code_view" value="프로모션 코드 보기 " /></span>
						<span class="btn small valign-middle lightblue"><input type="button" id="promotion_code_excel_down" value="프로모션 코드 엑셀 다운로드" /></span>
					</div>
				{: promotion.promotion_type == 'one' }
					<input type="hidden" name="promotion_type" value="one" >
					<div class="promotion_type2"  style="padding:5px 0 0 0;">
						<label for="promotion_type2">{promotion.promotion_code_size}자리 프로모션 코드 [{promotion.promotion_input_serialnumber}]</label>
						<span class="btn small valign-middle cyanblue"><input type="button" id="promotion_code_copy" promotion_input_serialnumber="{promotion.promotion_input_serialnumber}" value="프로모션 코드 복사" /></span>
					</div>
				<!--{/}-->
			</td>
		</tr>
		{: promotion.promotion_type == 'file' || promotion.promotion_type == 'input' }
		<tr>
			<th class="its-th">수동 생성</th>
			<td  class="its-td" >
			{? promotion.promotion_type == 'file'}
					<input type="hidden" name="promotion_type" value="file" >
				<div class="promotion_type3"  style="padding:5px 0 0 0;"> 랜덤한 4-4-4-4자리의 프로모션 코드 수동등록 [총 {=number_format(promotion.filepromotiontotal)}건]
					<span class="btn small valign-middle cyanblue"><input type="button" id="promotion_code_view" value="프로모션 코드 보기 " /></span>
					<span class="btn small valign-middle lightblue"><input type="button" id="promotion_code_excel_down" value="프로모션 코드 엑셀 다운로드" /></span>
				</div>
			{: promotion.promotion_type == 'input' }
				<input type="hidden" name="promotion_type" value="input" >
				<input type="hidden" name="promotion_input_num" value="{promotion.promotion_input_serialnumber}" >
				<div class="promotion_type4"  style="padding:5px 0 0 0;">
				{promotion.promotion_code_size}자리 프로모션 코드 [{promotion.promotion_input_serialnumber}] </label>
				<span class="btn small valign-middle cyanblue"><input type="button" id="promotion_code_copy" promotion_input_serialnumber="{promotion.promotion_input_serialnumber}" value="프로모션 코드 복사" /></span>
				</div>
			<!--{/}-->
			</td>
		</tr>
		<!--{/}-->
		</table>
	{:}
		<div  >
			<table class="info-table-style" style="width:100%" border="0">
			<colgroup>
				<col width="15%"/>
				<col />
				<col width="35%"/>
			</colgroup>
			<tbody>
			<tr>
				<th class="its-th"><label for="promotion_type1" ><input type="radio" name="promotion_type" id="promotion_type1" value="one" checked="checked" /> 자동 생성(권장)</label></th>
				<td class="its-td" >
					<div class="promotion_type1 promotion"  style="padding:5px 0 0 0;">
						<select name="promotionLimit_size1" id="promotionLimit_size1">
						<option value="5" selected="selected" >5</option>
						<option value="6">6</option>
						</select>자리 프로모션 코드값 1개 자동 생성
					</div>
					<div class="promotion_type1 admin point"  style="padding:5px 0 0 0;">랜덤한 4-4-4-4자리의 프로모션 코드값 자동 생성</div>
				</td>
			</tr>
			<tr>
				<th class="its-th"><label for="promotion_type2" ><input type="radio" name="promotion_type" id="promotion_type2" value="input" /> 수동 생성</label>
				<span class="helpicon admin point" title="※ 엑셀양식의 제일 첫째라인은 수정하지 말아주세요.<br />
				※ 프로모션코드는 서로 달라야 하며, 절대 중복되지 말아야 합니다. <br />
				&nbsp;&nbsp;&nbsp; (중복된 프로모션코드는 등록되지 않습니다)<br />
				※ 프로모션코드는 숫자 또는 영문으로 4-4-4-4자로 되어 있어야 합니다."></span>
				</th>
				<td class="its-td" >
				<div class="promotion_type2 promotion"  style="padding:5px 0 0 0;">
					<select name="promotionLimit_size2" id="promotionLimit_size2">
					<option value="5" selected="selected" >5</option>
					<option value="6">6</option>
					</select>자리 <label for="promotion_type2"> <input type="text" name="promotion_input_num" id="promotion_input_num" value="" title="자리수에 맞게 입력하세요." size="25" class="line"></label>
				</div>

				<div class="promotion_type3 admin point"  style="padding:5px 0 0 0;">
					랜덤한 4-4-4-4자리의 프로모션 코드값 수동 생성 <input type="hidden" name="promotion_file" id="promotion_file" >
					<label for="promotion_type3"><span class="btn small lightblue"><button type="button" class="batchExcelRegist">엑셀등록</button></span></label>
					 <span class="btn small valign-middle"><input type="button" class="promotion_code_form" value="양식 다운로드" /></span> </label>
				</div>

				</td>
			</tr>
			</table>
		</div>
	<!--{/}-->
	</td>
</tr>

<tr>
	<th class="its-th-align left pdl10">혜택
		<div>
			<span class="btn small orange addsaleGuideBtn "><button type="button" class="hand" >안내) 추가 혜택 적용 범위</button></span>
		</div>
	</th>
	<td class="its-td" colspan="3">
	<table class="info-table-style" style="width:100%" border="0">
	<colgroup>
		<col width="15%"/>
		<col />
		<col width="35%"/>
	</colgroup>
	<tbody>
	{? promotion.promotion_seq  }
		{? promotion.sale_type == 'shipping_free' || promotion.sale_type == 'shipping_won' }
			<tr><td class="its-td" >
				<div  style="width:370px;">
						<div style="padding:5px 0 0 0;">
							<label>
							<input type="radio" name="saleType"  id="saleType_shipping_free"  value="shipping_free"  />
							기본 배송비 무료,</label>
							<span>최대 <input type="text" name="maxPercentShippingSale" size="5"   value="{promotion.max_percent_shipping_sale}" class="onlynumber right" />원</span>
							(개별 배송 상품 제외)
						</div>
						<div class="" style="padding:5px 0 0 0;">
							<label> <input type="radio" name="saleType"  id="saleType_shipping_won"  value="shipping_won"> 기본 배송비  </label><input type="text" name="wonShippingSale" size="5" class="line onlynumber right" value="{promotion.won_shipping_sale}" />원 할인
							(개별 배송 상품 제외)
						</div>

						<span class="desc  pt5 "><font color="red">※단, 배송비 혜택은 본사배송비 한하여 적용됩니다.</font></span>
				</div>
				</td>
			</tr>
		{:}
		<tr><td class="its-td" >
			<div >
					<div class="" style="padding:5px 0 0 0;">
						<label>
						<input type="radio" name="saleType" id="saleType_percent" value="percent"  {? !promotion.promotion_seq } checked="checked"{/} >
						상품 할인가(판매가) X 수량1개의 </label><input type="text" name="percentGoodsSale" size="3" maxlength="3" class="line onlynumber right" value="{promotion.percent_goods_sale}" />% 할인,
						<label>
						<span>수량 1개의 최대 할인금액 <input type="text" name="maxPercentGoodsSale" size="5" value="{promotion.max_percent_goods_sale}" class="onlynumber right"/>원</span>
						</label>
					</div><span class="desc gray" >
							- 수량 1개를 기준으로 최대 할인금액을 설정하는 이유는 상품 할인가(판매가)가 고가 또는 저가라도 동일하게 할인금액을 제한할 수 있기 때문입니다.
						</span>
					<div class="" style="padding:5px 0 0 0;">
						<label>
						<input type="radio" name="saleType" id="saleType_won" value="won"> 상품 할인가(판매가) X 수량1개의 </label><input type="text" name="wonGoodsSale" size="6" class="line onlynumber right" value="{promotion.won_goods_sale}" />원 할인
					</div>
			</div>
			<div  class="promotion " >
				<div style="padding:10px 0 0 0;" >
					<label class="duplicationUsetitle {? promotion.sale_type == 'shipping_free' || promotion.sale_type == 'shipping_won' }gray{/}" ><input type="checkbox" name="duplicationUse" id="duplicationUse" value="1"  {? promotion.sale_type == 'shipping_free' || promotion.sale_type == 'shipping_won' } disabled="disabled" {/}/> 중복할인</label><span class="desc"> - 일반 코드(공용) 일 경우 여러 번 사용가능 하므로, 중복할인 체크를 적극 권장합니다.</span>
					<div class="duplicationuselay {? promotion.duplication_use != 1 } gray{/}" >
						- 상품 수량에 중복할인 : A상품10,000원x10개 - (10%할인프로모션x10개) = 90,000원<br />
						- 상품 종류에 중복할인 : A상품10,000원x10개 - (10%할인프로모션x10개) + B상품10,000원x10개 - (10%할인프로모션x10개) = 180,000원
					</div>
				</div>
			</div>
			</td>
		</tr>
		{/}
	{:}
		<tr><td class="its-td" >
			<div  >
					<div class="" style="padding:5px 0 0 0;">
						<label>
						<input type="radio" name="saleType" id="saleType_percent" value="percent"  {? !promotion.promotion_seq } checked="checked"{/} >
						상품 할인가(판매가) X 수량1개의 </label><input type="text" name="percentGoodsSale" size="3" maxlength="3" class="line onlynumber right" value="{promotion.percent_goods_sale}" />% 할인,
						<label>
						<span>수량 1개의 최대 할인금액 <input type="text" name="maxPercentGoodsSale" size="5" value="{promotion.max_percent_goods_sale}" class="onlynumber right"/>원</span>
						</label>
					</div>

						<span class="desc gray" >
							- 수량 1개를 기준으로 최대 할인금액을 설정하는 이유는 상품 할인가(판매가)가 고가 또는 저가라도 동일하게 할인금액을 제한할 수 있기 때문입니다.
						</span>
					<div class="" style="padding:5px 0 0 0;">
						<label>
						<input type="radio" name="saleType" id="saleType_won" value="won"> 상품 할인가(판매가) X 수량1개의 </label><input type="text" name="wonGoodsSale" size="6" class="line onlynumber right" value="{promotion.won_goods_sale}" />원 할인
					</div>
			</div>
			<div  class="promotion " >
				<div style="padding:10px 0 0 0;" >
					<label class="duplicationUsetitle {? promotion.sale_type == 'shipping_free' || promotion.sale_type == 'shipping_won' }gray{/}" ><input type="checkbox" name="duplicationUse" id="duplicationUse" value="1"  {? promotion.sale_type == 'shipping_free' || promotion.sale_type == 'shipping_won' } disabled="disabled" {/}/> 중복할인</label>
					<div class="duplicationuselay {? promotion.duplication_use != 1 } gray{/}" >
						- 상품 수량에 중복할인 : A상품10,000원x10개 - (10%할인프로모션x10개) = 90,000원<br />
						- 상품 종류에 중복할인 : A상품10,000원x10개 - (10%할인프로모션x10개) + B상품10,000원x10개 - (10%할인프로모션x10개) = 180,000원
					</div>
				</div>
			</div>
		</td>
		</tr>
		<tr><td class="its-td" >
			<div  style="width:370px;">
					<div style="padding:5px 0 0 0;">
						<label>
						<input type="radio" name="saleType"  id="saleType_shipping_free"  value="shipping_free"  />
						기본 배송비 무료,</label>
						<span>최대 <input type="text" name="maxPercentShippingSale" size="5"   value="{promotion.max_percent_shipping_sale}" class="onlynumber right" />원</span>
						(개별 배송 상품 제외)
					</div>
					<div class="" style="padding:5px 0 0 0;">
						<label> <input type="radio" name="saleType"  id="saleType_shipping_won"  value="shipping_won"> 배송비 </label><input type="text" name="wonShippingSale" size="5" class="line onlynumber right" value="{promotion.won_shipping_sale}" />원 할인
					</div>

					<span class="desc  pt5 "><font color="red">※단, 배송비 혜택은 본사배송비 한하여 적용됩니다.</font></span>
			</div>
			</td>
		</tr>
	{/}
	</table>
	</td>
</tr>

<tr>
	<th class="its-th-align left pdl10">유효 기간</th>
	<td class="its-td" colspan="3">
		<div class="promotion admin point ">
			<label><input type="radio" name="issuePriodType" id="issuePriodType0" value="date" {? !promotion.promotion_seq } checked="checked" {/} /></label>
			<input type="text" name="issueDate[]" value="{promotion.issue_startdate}" class="datepicker line"  maxlength="10" size="10" />~<input type="text" name="issueDate[]" value="{promotion.issue_enddate}" class="datepicker line"  maxlength="10" size="10" />
		</div>
		<div class="admin point">
			<label>
			<input type="radio" name="issuePriodType"  id="issuePriodType1"  value="day" />
			발급일로부터 </label><input type="text" name="afterIssueDay" size="2" value="{promotion.after_issue_day}" class="onlynumber" >일 동안 사용 가능
		</div>
	</td>
</tr>


<tr>
	<th class="its-th-align left pdl10">사용제한 - 금액</th>
	<td class="its-td" colspan="3">
		<span class="red">{상품 할인가(판매가) X 수량} + {\좌동} + {\좌동}...</span> <input type="text" name="limitGoodsPrice" size="6" value="{promotion.limit_goods_price}" class="onlynumber right" />원 이상이면 사용가능.
	</td>
</tr>


<tr>
	<th class="its-th-align left pdl10">선착순/회원</th>
	<td class="its-td" colspan="3">
		<label class="promotionLimit_input_title"> <input type="checkbox" name="downloadLimit_promotion" id="downloadLimit_promotion" value="limit" /> 선착순 </label><span class="downloadLimitlay {? promotion.download_limit != 'limit' } gray{/}" ><input type="text" name="downloadLimitEa_promotion" id="downloadLimitEa_promotion" value="" size="5"  class="line onlynumber"  {?  promotion.download_limit != 'limit' } disabled="disabled" {/} />명까지 사용 가능</span>
		<label class="promotionLimit_input_title promotion admin ">, <input type="checkbox" name="downloadLimit_member" id="downloadLimit_member" value="1" /> 회원만 사용 가능</label>
	</td>
</tr>


<tr id="issueexceptlay"  class="{? strstr(promotion.sale_type,'shipping')}hide{/}">
	<th class="its-th-align left pdl10">사용제한 - 상품/카테고리/브랜드  </th>
	<td class="its-td" colspan="3">

	<table class="info-table-style" style="width:100%">
		<tbody>
		<tr>
			<th class="its-th"><input type="radio" name="issue_type" id="issue_type0" value="all" checked="checked" > <label for="issue_type0">전체상품에 프로모션 코드 사용 가능</label></th>
			<th class="its-th"><input type="radio" name="issue_type" id="issue_type1" value="issue" > <label for="issue_type1">특정 상품/카테고리/브랜드에서만 프로모션 코드 사용 가능</label></th>
			<th class="its-th"><input type="radio" name="issue_type" id="issue_type2" value="except" > <label for="issue_type2">특정 상품/카테고리/브랜드에서는 프로모션 코드 사용 불가</label></th>
		</tr>
		<tr class="issuetypelay"><td colspan="3" class="its-td" >
				<div id="issuesgoodslay" class="hide " >
					<div style="margin:10px;" >
						<div>
							<span class="btn small gray"><button type="button" id="issueGoodsButton">코드 상품 등록</button></span>
							<span class="desc">노출순서변경</span> <span class="helpicon" title="상품을 마우스로 드래그&드랍해서 조정합니다."></span>
						</div>
						<div class="clearbox" style="height:5px;"></div>
						<div id="issueGoods" >
						<!--{ @ issuegoods }-->
						<!--{ ? .type == 'issue' }-->
						<div class='goods fl move'>
						<div align='center' class='image'>
							<img class="goodsThumbView" alt="" src="{.image}" width="50" height="50">
						</div>
						<div align='center' class='name' style='width:70px;overflow:hidden;white-space:nowrap;'>{.goods_name}</div>
						<div align='center' class='price'>{=number_format(.price)}</div>
						<input type="hidden" name='issueGoods[]' value='{.goods_seq}' />
						<input type="hidden" name="issueGoodsSeq[{.goods_seq}]" value="{.issuegoods_seq}" />
						</div>
						<!--{ / }-->
						<!--{ / }-->
						</div>
						<div id="issueGoodsSelect" class="hide"></div>
					</div>
				</div>
			<div style="clear: both"></div>
				<div id="issuescategorylay" class="hide  " >
					<div  style="margin:10px;">
						<div>
							<select class="line" name="category1">
								<option value="">1차 카테고리</option>
							</select>
							<select class="line" name="category2">
								<option value="">2차 카테고리</option>
							</select>
							<select class="line" name="category3">
								<option value="">3차 카테고리</option>
							</select>
							<select class="line" name="category4">
								<option value="">4차 카테고리</option>
							</select>
							<span class="btn small gray"><button type="button" id="issueCategoryButton">코드 카테고리 등록</button></span>
						</div>
						<div id="issueCategory" >
						<!--{ @ issuecategorys }-->
						<!--{ ? .type == 'issue' }-->
						<div style='padding:5px;'>
						<span style='display:inline-block;width:300px'>{.category}</span>
						{? promotion.downloadtotal < 1 }<span class='btn-minus'><button type='button' class='delCategory'></button></span><!--{/}-->
						<input type="hidden" name='issueCategoryCode[]' value='{.category_code}' />
						<input type="hidden" name="issueCategoryCodeSeq[{.category_code}]" value="{.issuecategory_seq}" />
						</div>
						<!--{ / }-->
						<!--{ / }-->
						</div>
					</div>
				</div>
				<div style="clear: both"></div>

				<div id="issuesbrandlay" class="hide" >
					<div  style="margin:10px;">
						<div>
							<select class="line" name="brand1" size="1" style="width:100px;"><option value="">1차 브랜드</option></select>
							<select class="line" name="brand2" size="1" style="width:100px;"><option value="">2차 브랜드</option></select>
							<select class="line" name="brand3" size="1" style="width:100px;"><option value="">3차 브랜드</option></select>
							<select class="line" name="brand4" size="1" style="width:100px;"><option value="">4차 브랜드</option></select>
							<span class="btn small gray"><button type="button" id="issueBrandButton">코드 브랜드 등록</button></span>
						</div>
						<div id="issueBrand" >
						<!--{ @ issuebrands }-->
							<!--{ ? .type == 'issue' }-->
							<div style='padding:5px;'>
							<span style='display:inline-block;width:300px'>{.brand}</span>
							{? promotion.downloadtotal < 1 }<span class='btn-minus'><button type='button' class='delBrand'></button></span><!--{/}-->
							<input type="hidden" name='issueBrandCode[]' value='{.brand_code}' />
							<input type="hidden" name="issueBrandCodeSeq[{.brand_code}]" value="{.issuebrand_seq}" />
							</div>
							<!--{ / }-->
						<!--{ / }-->
						</div>
					</div>
				</div>


				<div style="clear: both"></div>
				<div   id="exceptgoodslay" class="hide  ">
					<div  style="margin:10px;">
						<div>
							<span class="btn small gray"><button type="button" id="exceptIssueGoodsButton">코드 예외 상품 등록</button></span>
							<span class="desc">노출순서변경</span> <span class="helpicon" title="상품을 마우스로 드래그&드랍해서 조정합니다."></span>
						</div>
						<div class="clearbox" style="height:5px;"></div>
						<div id="exceptIssueGoods">
						<!--{ @ issuegoods }-->
						<!--{ ? .type == 'except' }-->
						<div class='goods fl move'>
						<div align='center' class='image'>
							<img class="goodsThumbView" alt="" src="{.image}" width="50" height="50">
						</div>
						<div align='center' class='name' style='width:70px;overflow:hidden;white-space:nowrap;'>{.goods_name}</div>
						<div align='center' class='price'>{=number_format(.price)}</div>
						<input type="hidden" name='exceptIssueGoods[]' value='{.goods_seq}' />
						<input type="hidden" name="exceptIssueGoodsSeq[{.goods_seq}]" value="{.issuegoods_seq}" />
						</div>
						<!--{ / }-->
						<!--{ / }-->
						</div>
						<div id="exceptIssueGoodsSelect" class="hide"></div>
					</div>
				</div>

				<div style="clear: both"></div>

				<div id="exceptcategorylay" class="hide  " >
					<div  style="margin:10px;">
							<div>
								<select class="line" name="exceptCategory1">
									<option value="">1차 카테고리</option>
								</select>
								<select class="line" name="exceptCategory2">
									<option value="">2차 카테고리</option>
								</select>
								<select class="line" name="exceptCategory3">
									<option value="">3차 카테고리</option>
								</select>
								<select class="line" name="exceptCategory4">
									<option value="">4차 카테고리</option>
								</select>
								<span class="btn small gray"><button type="button" id="exceptIssueCategoryButton">코드 예외 카테고리 등록</button></span>
							</div>
						<div id="exceptIssueCategory">
							<!--{ @ issuecategorys }-->
							<!--{ ? .type == 'except' }-->
							<div style='padding:5px;'>
								<span style='display:inline-block;width:300px'>{.category}</span>
								{? promotion.downloadtotal < 1 }<span class='btn-minus'><button type='button' class='delCategory'></button></span><!--{/}-->
								<input type="hidden" name='exceptIssueCategoryCode[]' value='{.category_code}' />
								<input type="hidden" name="exceptIssueCategoryCodeSeq[{.category_code}]" value="{.issuecategory_seq}" />
							</div>
							<!--{ / }-->
							<!--{ / }-->
						</div>
					</div>
				</div>

				<div style="clear: both"></div>

				<div id="exceptbrandlay" class="hide" >
					<div  style="margin:10px;">
							<div>
								<select class="line" name="exceptbrand1" size="1" style="width:100px;"><option value="">1차 브랜드</option></select>
								<select class="line" name="exceptbrand2" size="1" style="width:100px;"><option value="">2차 브랜드</option></select>
								<select class="line" name="exceptbrand3" size="1" style="width:100px;"><option value="">3차 브랜드</option></select>
								<select class="line" name="exceptbrand4" size="1" style="width:100px;"><option value="">4차 브랜드</option></select>
								<span class="btn small gray"><button type="button" id="exceptIssueBrandButton">코드 예외 브랜드 등록</button></span>
							</div>
						<div id="exceptIssuebrand">
							<!--{ @ issuebrands }-->
							<!--{ ? .type == 'except' }-->
							<div style='padding:5px;'>
								<span style='display:inline-block;width:300px'>{.brand}</span>
								{? promotion.downloadtotal < 1 }<span class='btn-minus'><button type='button' class='delBrand'></button></span><!--{/}-->
								<input type="hidden" name='exceptIssueBrandCode[]' value='{.brand_code}' />
								<input type="hidden" name="exceptIssueBrandCodeSeq[{.brand_code}]" value="{.issuebrand_seq}" />
							</div>
							<!--{ / }-->
							<!--{ / }-->
						</div>
					</div>
				</div>

		</td>
		</tr>
	</table>
	</td>
</tr>
<tr class="promotion">
	<th class="its-th-align left pdl10">배경이미지
	</th>
	<td class="its-td" colspan="3"  >
		<div class="promotion" >
			<label ><input type="checkbox" name="mainshow" id="mainshow" value="1" /> 쇼핑몰 화면에 해당 프로모션 코드 정보를 노출함</label> <br/>
			<table>
			<col width="500" />
			<tr>
				<td align="center" colspan="2" >
				<div class="promotioncodeshow" {promotion.node_text_normal_style}>{? promotion.node_text_title }{promotion.node_text_title}{:}{? !promotion }[프로모션코드설명] Promotion Code : [프로모션코드]{/}{/}</div>
				</td>
			</tr>
			<tr>
				<td align="center">
				<input type="text" name="node_text"  id="node_text" size="85" value="{? promotion.node_text }{promotion.node_text}{:}{? !promotion }[프로모션코드설명] Promotion Code : [프로모션코드]{/}{/}" class="center"  title="" /></td>
				<td>
				&nbsp;<input type="text" name="node_text_normal"  id="node_text_normal" value='{promotion.node_text_normal}'  class="customFontDecoration" />
				<textarea class="hide" name="node_text_normal_orign" >{promotion.node_text_normal}</textarea>
				</td>
			</tr>
			<tr>
				<td align="center">
					<input type="text" name="node_text_normal_url" value="{promotion.node_text_normal_url}" title="링크URL" class="line" size="85" /></td>
				<td>
					<select name="node_text_normal_url_target" class="custom-select-box">
						<option value="_self" {? promotion.node_text_normal_url_target == "_self" } selected="selected" {/}>현재창</option>
						<option value="_blank"  {? !promotion.node_text_normal_url_target || promotion.node_text_normal_url_target == '_blank' } selected="selected" {/}>새창</option>
					</select>
				</td>
			</tr>
			</table>
			<span class="desc promotion">
			※ 라이브 되고 있는 프로모션 코드 중 일반코드가 롤링되어 집니다.
			</span>

			<div style="clear: both"></div>
		</div>
		<div class="" >
			<div>
				<div style="text-align: center; margin: 10px;">
					<div style="float:left; margin-top:18px;" ><input type="radio" name="promotionImg" id="promotionImg1" value="1" {? !promotion.promotion_seq } checked="checked" {/} /></div>
					<div style="float:left; margin-left:5px;" class="promotionImg1" src_sample="/data/promotion/promotion_skin_01.gif" src_orign="/data/promotion/promotion_skin_01.gif" ><label for="promotionImg1"><img src="/data/promotion/promotion_skin_01.gif" id="promotionImg1src" height="40"/></label></div><div style="clear: both"></div>
				</div>
			</div>
			<div  >
				<input type="hidden" name="promotionimage4" id="promotionimage4" value="" >
				 <div class="pdr10" style="margin-left:30px;">
					<label for="promotionImg4"><span class="btn small lightblue"><button type="button" class="batchImageRegist">배경이미지등록 (가로가변*세로40)</button></span></label>
				</div>
				<div style="width: 815px; text-align: center;  margin: 10px;">
					<div style="float:left;margin-top:18px;" ><input type="radio" name="promotionImg"  id="promotionImg4"  value="4"/> </div>
					<div style="float:right;"><div style='width: 800px;min-height:40px;border: 1px dotted #2EA4C0;' id="promotionimage4lay">{? promotion.promotion_image4 }<img src="/data/promotion/{promotion.promotion_image4}"/><!--{/}--></div>
					</div><div style="clear: both"></div>
					</div>
				</div>
			</div>
			<div style="clear: both"></div>

		</div>
	</td>
</tr>


<tr >
	<td  colspan="4"  >
	<div style="padding:5px;">
		<table  class="info-table-style" width="100%" align="center">
		<col width="140" />
		<tr>
			<td class="its-th">전체 프로모션코드 치환코드 <span class="btn small" ><input type="button" id="promocodeallhtml_btn" value="소스복사" /></span> </th>
		</tr>
		</table>
		<div id="originalSourceTextareaContainerall"><textarea id="originalSourceTextareaall">{=htmlspecialchars(promocodeallhtml)}</textarea></div>
		<textarea id="originalSourceTextareaallorgin" class="hide">{promocodeallhtml}</textarea>
		<br/>
		<!--{ ? promotion.promotion_seq }-->
		<table  class="info-table-style" width="100%" align="center">
		<col width="140" />
		<tr>
			<td class="its-th">해당 프로모션코드만 치환코드 <span class="btn small" ><input type="button" id="promocodehtml_btn" value="소스복사" /></span> </th>
		</tr>
		</table>
		<div id="originalSourceTextareaContainer"><textarea id="originalSourceTextarea">{=htmlspecialchars(promocodehtml)}</textarea></div>
		<textarea id="originalSourceTextareaorgin" class="hide">{promocodehtml}</textarea>
		<!--{ : }-->
		<table  class="info-table-style" width="100%" align="center">
		<col width="140" />
		<tr>
			<td class="its-th">해당 프로모션코드만 치환코드<span class="btn small" ><input type="button" id="promocodehtml_btn" value="소스복사" /></span> </th>
		</tr>
		</table>
		<div id="originalSourceTextareaContainer"><textarea id="originalSourceTextarea">{=htmlspecialchars(promocodehtml)}</textarea></div>
		<textarea id="originalSourceTextareaorgin" class="hide">{promocodehtml}</textarea>
		<!--{ / }-->
	</div>
	</td>
</tr>

</tbody>
</table>
<div style="height:30px;"></div>
</form>

<!-- 이미지 업로드 다이얼로그 -->
<div id="imageUploadDialog" class="hide">
	<table width="100%" class="info-table-style">
		<col width="150" />
		<tr>
			<th class="its-th">파일형식, 사이즈</th>
			<td class="its-td">.JPG, .GIF, .PNG / 350 * 150</td>
		</tr>
		<tr>
			<th class="its-th">업로드경로</th>
			<td class="its-td">/<span class="uploadPath"></span></td>
		</tr>
		<tr>
			<th class="its-th">파일찾기</th>
			<td class="its-td">
				<div class="pdr10">
					<img class="imageUploadBtnImage hide" src="../images/common/btn_filesearch.gif">
					<input id="imageUploadButton" type="file" name="file" value="" class="uploadify" />
				</div>
			</td>
		</tr>
	</table>
	<div class="center pdt20 pdb20"><span class="btn medium"><input type="button" value="업로드" onclick="$('#imageUploadButton').uploadifyUpload();" /></span></div>
</div>

<!--{ ? groups }-->
<div id="setGroupsPopup" class="hide">
<!--{ @ groups }-->
<div style="float:left;padding-right:5px;">
	<label><input type="checkbox" name="memberGroup" id="memberGroup_{.group_seq}"  value="{.group_seq}" class="line" >{.group_name}</label>
</div>
<!--{ / }-->
</div>
<!--{ / }-->

<div id="downloadwrite" class="hide">
	<table class="info-table-style" width="100%" cellspacing="0">
	<colgroup>
	</colgroup>
	<tbody>
		<tr>
			<th class="its-th">발급건수</th><td class="its-td"><span id="dlwrite_4" ></span></td>
			<th class="its-th">제한금액</th><td class="its-td"><span id="dlwrite_1" ></span></td>
			<th class="its-th">유효기간</th><td class="its-td"><span id="dlwrite_2" ></span></td>
			<th class="its-th">혜택</th><td class="its-td"><span id="dlwrite_3" ></span></td>
		</tr>
	</tbody>
	</table><br/>
	<form name="downloadwriteform" id="downloadwriteform" method="post" action="../promotion_process/download_write" target="actionFrame">
	<input type="hidden" name="no" id="write_no" value="" >
	<input type="hidden" name="promotion_name" id="write_promotion_name" value="" >
	<table class="info-table-style" width="100%" cellspacing="0">
	<colgroup>
		<col width="80px" />
		<col width="" />
	</colgroup>
	<tbody>
		<tr>
			<th  class="its-th-align center">발급대상</th>
			<td>
				<table class="b_tb fm" width="100%" cellspacing="0">
				<colgroup>
					<col width="" />
				</colgroup>
				<tbody>
					<tr>
						<td class="its-td"><input type="radio" name="target_type" id="target_type1" value="all"/> <label for="target_type1" ><span id="downloadmbtotalcountlay" >전체회원 {member_total_count}명</span></label> </td>
					</tr>

					<tr>
						<td class="its-td"><input type="radio" name="target_type" id="target_type2"  value="group" /> <label for="target_type2" >회원그룹 <span class="btn small gray"><input type="button" id="download_group_search"  value="그룹선택" /></span></label>
						<br> <div id="groupsMsg"></div>
						</td>
					</tr>
					<tr>
						<td class="its-td"><input type="radio" name="target_type" id="target_type3"  value="member"  checked="checked" /> <label for="target_type3" >개별회원 선택
							<span class="btn small gray"><input type="button" class="download_member_search"  value="회원검색" /></span></label>
						</td>
					</tr>
					<tr>
						<td class="its-td"><input type="hidden" name="target_member" id="target_member" value="">
							선택회원 : <span id="member_search_count">0</span> 명
							<div id="target_container" style="width:95%; border: 1px dotted #2EA4C0; height: 230px; margin: 5px 0; padding: 5px 10px; overflow-y: auto"></div>
						</td>
					</tr>
				</tbody>
				</table>
			</td>
		</tr>
		</td>
		<tr>
		<td class="its-td center" colspan="2">
			<span class="btn large black"><input type="submit" id="download_create"  value="발급하기" /></span>
			<span class="btn large black"><input type="button" id="download_cancel"  value="취소하기" onclick="$('#downloadwrite').dialog('close');"/></span>
		</td>
		</tr>
	</tbody>
	</table>
	</form>
</div>


<!-- 첨부파일 업로드 다이얼로그 -->
<div id="ExcelUploadDialog" class="hide">
	<table width="100%" class="info-table-style">
	<col width="160" />
	<tr>
		<th class="its-th">엑셀 데이터 등록 안내</th>
		<td class="its-td">프로모션 코드를 엑셀 데이터로 등록할 수 있습니다.<br>
		엑셀 양식을 다운로드 받아 형식에 맞게 데이터를 입력해 주세요.
		</td>
	</tr>
	<tr>
		<th class="its-th">엑셀 데이터 입력 방법</th>
		<td class="its-td">
			1. 기본적으로 다운로드 받은 엑셀 양식을 유지한 후 데이터만 입력<br />
			2. 반드시 A열에는 프로모션 코드를 입력<br />
			3. 엑셀양식의 제일 첫째라인은 수정하지 말아주세요.<br/>
			4. 프로모션 코드는 랜덤형으로 같은 코드가 없어야 합니다. <br>&nbsp;&nbsp;&nbsp;&nbsp;(중복된 프로모션 코드는 등록하지 않습니다.)<br/>
			5. 프로모션 코드는 숫자 또는 영문으로 4-4-4-4자로 되어 있어야 합니다.<br />
			<!-- <!img src="../images/common/promotion_sample.jpg"><br /> -->
			6. 입력완료 후 엑셀파일 저장 형식을 *.xls로 저장<br />

		</td>
	</tr>
	<tr>
		<th class="its-th">엑셀 파일 업로드</th>
		<td class="its-td"><span class="btn small valign-middle"><input type="button" class="promotion_code_form" value="양식 다운로드" /></span></td>
	</tr>
	<tr>
		<td class="its-td" colspan="2" >
			<div class="pdr10">
				<input id="ExcelUploadButton" type="file" name="file" value="" class="uploadify" />
			</div>
		</td>
	</tr>
	</table>
	<div class="center pdt20 pdb20"><span class="btn medium"><input type="button" value="업로드" onclick="$('#ExcelUploadButton').uploadifyUpload();" /></span></div>
</div>

{ #layout_footer }